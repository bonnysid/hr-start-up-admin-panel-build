"use strict";(self.webpackChunkhr_start_up_admin_panel=self.webpackChunkhr_start_up_admin_panel||[]).push([[847],{9973:function(n,e,i){i.d(e,{v:function(){return k}});var t,r,s,a,o,l=i(2791),d=i(168),u=i(6444),c=i(2450),f=i(4075),h=u.ZP.div(t||(t=(0,d.Z)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  position: relative;\n  width: 100%;\n  justify-content: ",";\n"])),(function(n){return n.isOwn?"flex-end":"flex-start"})),p=u.ZP.div(r||(r=(0,d.Z)(["\n  display: flex;\n  align-items: flex-end;\n  position: relative;\n  gap: 10px;\n  width: fit-content;\n  height: fit-content;\n  padding: 8px 8px 4px 8px;\n  max-width: calc(50% - 10px);\n  border-radius: 5px;\n  background-color: ",";\n"])),(function(n){return n.isOwn?c.D.blue30:c.D.lightGray30})),x=(0,u.ZP)(f.L)(s||(s=(0,d.Z)(["\n  width: 200px;\n  top: -43px !important;\n  left: -150px;\n  \n  & > div {\n    background: ",";\n  }\n"])),c.D.blue20),v=u.ZP.div(a||(a=(0,d.Z)(["\n  padding-bottom: 5px;\n"]))),g=u.ZP.div(o||(o=(0,d.Z)(["\n  color: ","\n"])),c.D.gray90),m=i(595),Z=i(3494),w=i(5033),b=i(5457),j=i(4469),y=i(9847),D=i(184),k=function(n){var e=n.message,i=n.withAvatar,t=(0,Z.aC)().user,r=(0,l.useRef)(null),s=(0,j.te)(),a=(0,j.te)(),o=(0,l.useMemo)((function(){return e.user.id===(null===t||void 0===t?void 0:t.id)}),[e,t]);return(0,D.jsxs)(h,{isOwn:o,children:[(0,D.jsxs)(p,{ref:r,isOwn:o,onContextMenu:function(n){"dialogId"in e&&(n.preventDefault(),o&&a.open())},children:[(0,D.jsx)(v,{children:e.text}),(0,D.jsx)(g,{children:(0,m.B)(e.updatedAt)}),a.isOpen&&(0,D.jsx)(x,{selectionContainer:r.current,onClose:a.close,children:(0,D.jsx)(w.zx,{variant:w.Wu.DANGER,text:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",fullWidth:!0,onClick:s.open})})]}),i&&(0,D.jsx)(w.u,{text:"".concat(e.user.lastName," ").concat(e.user.firstName),children:(0,D.jsx)(w.qE,{firstName:e.user.firstName,lastName:e.user.lastName,fullName:e.user.email,src:e.user.avatar,size:w.DZ.XXL})}),s.isOpen&&(0,D.jsx)(b.V,{type:b.w.WARNING,closeHandler:s.close,onConfirm:function(){"dialogId"in e&&(y.v.deleteMessage({messageId:e.id}),s.close())},actions:{cancel:{text:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c",onClick:s.close},submit:{text:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"}},children:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?"})]})}},6847:function(n,e,i){i.r(e),i.d(e,{default:function(){return mn}});var t,r,s,a,o,l,d,u,c,f,h,p,x,v,g,m,Z,w,b,j,y,D,k=i(3433),N=i(1413),P=i(4165),M=i(5861),E=i(9439),S=i(2791),I=i(168),C=i(6444),A=i(2450),_=C.ZP.div(t||(t=(0,I.Z)(["\n  display: flex;\n  flex-direction: column;\n  grid-row-gap: 24px;\n  width: 100%;\n  height: 100%;\n  padding: 24px;\n"]))),G=C.ZP.div(r||(r=(0,I.Z)(["\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  border: 1px solid ",";\n  background: ",";\n  border-radius: 5px;\n"])),A.D.lightGray40,A.D.white),L=C.ZP.div(s||(s=(0,I.Z)(["\n  max-width: ",";\n  height: 100%;\n  width: 100%;\n  overflow-y: auto;\n\n  &::-webkit-scrollbar {\n    width: 0;\n  }\n"])),(function(n){return n.hasActive?"400px":"100%"})),O=C.ZP.div(a||(a=(0,I.Z)(["\n  display: flex;\n  flex-direction: column;\n  max-width: ",";\n  width: 100%;\n  min-height: 100%;\n  height: fit-content;\n  border-right: ",";\n  background: ",";\n  overflow: hidden;\n"])),(function(n){return n.hasActive?"400px":"100%"}),(function(n){return n.hasActive?"1px solid ".concat(A.D.lightGray40):"none"}),A.D.white),X=C.ZP.div(o||(o=(0,I.Z)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n"]))),H=i(5033),T=i(9514),z=i(4346),B=i(4469),J=C.ZP.div(l||(l=(0,I.Z)(["\n  display: flex;\n  align-items: center;\n  width: 100%;\n  gap: 12px;\n  cursor: pointer;\n  height: fit-content;\n  transition: background-color .3s;\n  padding: 10px;\n  overflow: hidden;\n  \n  &:hover {\n    background-color: ",";\n  }\n"])),A.D.blue20),R=C.ZP.div(d||(d=(0,I.Z)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 5px;\n  width: 100%;\n"]))),q=C.ZP.div(u||(u=(0,I.Z)(["\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  overflow: hidden;\n  gap: 5px;\n"]))),W=(0,C.ZP)(H.g2)(c||(c=(0,I.Z)(["\n  white-space: nowrap;\n  color: ",";\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n"])),A.D.gray90),Q=C.ZP.div(f||(f=(0,I.Z)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 20px;\n  min-width: 20px;\n  height: 20px;\n  min-height: 20px;\n  background-color: ",";\n  color: ",";\n  border-radius: 10px;\n"])),A.D.blue60,A.D.white),V=(0,C.ZP)(H.g2)(h||(h=(0,I.Z)(["\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n"]))),F=C.ZP.div(p||(p=(0,I.Z)(["\n  color: ",";\n  white-space: nowrap;\n"])),A.D.gray90),K=i(595),U=i(184),Y=function(n){var e=n.dialog,i=n.onClick;return(0,U.jsxs)(J,{onClick:i,children:[(0,U.jsx)(H.qE,{userId:e.user.id,firstName:e.user.firstName,lastName:e.user.lastName,src:e.user.avatar,size:H.DZ.XXXL}),(0,U.jsxs)(q,{children:[(0,U.jsxs)(R,{children:[(0,U.jsxs)(V,{tooltip:!0,children:[e.user.lastName," ",e.user.firstName," (",e.user.email,")"]}),(0,U.jsx)(F,{children:(0,K.B)(e.lastMessage.updatedAt)})]}),(0,U.jsxs)(R,{children:[(0,U.jsx)(W,{children:e.lastMessage.text}),Boolean(e.unreadableMessages)&&(0,U.jsx)(Q,{children:e.unreadableMessages})]})]})]})},$=i(7512),nn=i(3131),en=C.ZP.div(x||(x=(0,I.Z)(["\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n"]))),tn=C.ZP.div(v||(v=(0,I.Z)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  gap: 10px;\n  width: 100%;\n  height: fit-content;\n  min-height: 100%;\n  padding: 10px;\n"]))),rn=C.ZP.div(g||(g=(0,I.Z)(["\n  position: absolute;\n  cursor: pointer;\n  bottom: 20px;\n  left: calc(50% - 69px);\n  display: flex;\n  padding: 4px 8px;\n  border-radius: 5px;\n  color: ",";\n  background-color: ",";\n  \n  &:hover {\n    background-color: ",";\n  }\n\n  &:active,\n  &.active {\n    background-color: ",";\n  }\n"])),A.D.lightGray10,A.D.blue60,A.D.blue70,A.D.blue80),sn=C.ZP.div(m||(m=(0,I.Z)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n"]))),an=C.ZP.div(Z||(Z=(0,I.Z)(["\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  position: relative;\n\n  &::-webkit-scrollbar {\n    width: 0;\n  }\n"]))),on=C.ZP.form(w||(w=(0,I.Z)(["\n  display: flex;\n  gap: 10px;\n  align-items: center;\n  padding: 10px;\n  border-top: 1px solid ",";\n"])),A.D.lightGray40),ln=C.ZP.button(b||(b=(0,I.Z)(["\n  background: transparent;\n"]))),dn=(0,C.ZP)(nn.I)(j||(j=(0,I.Z)(["\n  cursor: pointer;\n  color: ",";\n  transition: color .3s;\n  \n  &:hover {\n    color: ",";\n  }\n"])),A.D.gray60,A.D.blue60),un=C.ZP.div(y||(y=(0,I.Z)(["\n  font-weight: 500;\n"]))),cn=C.ZP.div(D||(D=(0,I.Z)(["\n  display: flex;\n  gap: 10px;\n  align-items: center;\n  padding: 10px;\n  border-bottom: 1px solid ",";\n  box-shadow: 0 7px 15px rgba(0,0,0,.05);\n"])),A.D.lightGray40),fn=i(9973),hn=i(9847),pn=i(1219),xn=i(3494),vn=i(5705),gn=function(n){var e=n.dialogId,i=n.user,t=n.onBack,r=(0,xn.aC)().user,s=(0,S.useState)(!0),a=(0,E.Z)(s,2),o=a[0],l=a[1],d=(0,S.useState)([]),u=(0,E.Z)(d,2),c=u[0],f=u[1],h=(0,S.useRef)(null),p=(0,S.useState)(!1),x=(0,E.Z)(p,2),v=x[0],g=x[1],m=(0,vn.TA)({initialValues:{message:""},onSubmit:function(n){Z(n.message)}}),Z=function(n){hn.v.sendMessage({dialogId:e,text:n}),m.resetForm()},w=function(){var n=(0,M.Z)((0,P.Z)().mark((function n(){var i;return(0,P.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,l(!0),n.next=4,z.m.fetchDialogInfo(e);case 4:i=n.sent,f(i.data.messages),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),(0,T._N)(n.t0);case 11:return n.prev=11,l(!1),n.finish(11);case 14:case"end":return n.stop()}}),n,null,[[0,8,11,14]])})));return function(){return n.apply(this,arguments)}}();(0,B.ie)((function(n){var i,t,s,a=JSON.parse(n);a.event===pn.u.MESSAGE&&a.dialogId===e&&(f((function(n){return[].concat((0,k.Z)(n),[a])})),a.user.id!==(null===r||void 0===r?void 0:r.id)&&(hn.v.readMessage({messageId:a.id}),h.current&&(null===(i=h.current)||void 0===i?void 0:i.scrollHeight)-(null===(t=h.current)||void 0===t?void 0:t.clientHeight)-(null===(s=h.current)||void 0===s?void 0:s.scrollTop)>=50&&g(!0)));if(a.event===pn.u.DELETE_MESSAGE){var o=JSON.parse(n);o.dialogId===e&&f((function(n){return n.filter((function(n){return n.id!==o.messageId}))}))}}),[e,r]);var b=function(){var n,e;null===(n=h.current)||void 0===n||n.scrollTo(0,null===(e=h.current)||void 0===e?void 0:e.scrollHeight)};(0,S.useLayoutEffect)((function(){if(h.current){var n,e,i,t=c[c.length-1],s=(null===(n=h.current)||void 0===n?void 0:n.scrollHeight)-(null===(e=h.current)||void 0===e?void 0:e.clientHeight)-(null===(i=h.current)||void 0===i?void 0:i.scrollTop);(t&&t.user.id===(null===r||void 0===r?void 0:r.id)||s<50)&&b()}}),[c]),(0,S.useLayoutEffect)((function(){o||b()}),[o]),(0,S.useEffect)((function(){w()}),[e]);var j=(0,S.useMemo)((function(){return o?(0,U.jsx)(H.QP,{}):c.length?c.map((function(n){return(0,U.jsx)(fn.v,{message:n},n.id)})):"\u041d\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"}),[c,o]);return(0,U.jsxs)(en,{children:[(0,U.jsxs)(cn,{children:[t&&(0,U.jsx)(H.zx,{onClick:t,children:(0,U.jsx)(nn.I,{type:"arrow-left"})}),(0,U.jsx)(H.qE,{userId:i.id,firstName:i.firstName,size:H.DZ.XXXL,lastName:i.lastName,src:i.avatar}),(0,U.jsxs)(un,{children:[i.lastName," ",i.firstName," (",i.email,")"]})]}),(0,U.jsxs)(sn,{children:[(0,U.jsx)(an,{ref:h,onScroll:function(){var n,e,i;h.current&&((null===(n=h.current)||void 0===n?void 0:n.scrollHeight)-(null===(e=h.current)||void 0===e?void 0:e.clientHeight)-(null===(i=h.current)||void 0===i?void 0:i.scrollTop)<25&&g(!1))},children:(0,U.jsx)(tn,{children:j})}),v&&(0,U.jsx)(rn,{onClick:b,children:"\u041d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})]}),(0,U.jsxs)(on,{onSubmit:m.handleSubmit,children:[(0,U.jsx)(H.gx,{name:"message",value:m.values.message,onChange:m.handleChange,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",onEnter:function(){return Z(m.values.message)}}),(0,U.jsx)(ln,{children:(0,U.jsx)(dn,{type:"send",size:nn.J.XL})})]})]})},mn=function(){var n=(0,xn.aC)().user,e=(0,$._)(),i=e.newDialog,t=e.clearNewDialog,r=e.activeDialog,s=e.setActiveDialog,a=(0,S.useState)([]),o=(0,E.Z)(a,2),l=o[0],d=o[1],u=(0,S.useState)(!0),c=(0,E.Z)(u,2),f=c[0],h=c[1],p=(0,S.useState)(""),x=(0,E.Z)(p,2),v=x[0],g=x[1],m=(0,B.Nr)(v,400),Z=(0,B.Lm)();(0,S.useEffect)((function(){if(i){var e=i.users.find((function(e){return e.id!==(null===n||void 0===n?void 0:n.id)}));e&&s({id:i.id,user:e}),t()}}),[i]);var w=function(){var n=(0,M.Z)((0,P.Z)().mark((function n(){var e;return(0,P.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,h(!0),n.next=4,z.m.fetchDialogs();case 4:e=n.sent,d(e.data),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),(0,T._N)(n.t0);case 11:return n.prev=11,h(!1),n.finish(11);case 14:case"end":return n.stop()}}),n,null,[[0,8,11,14]])})));return function(){return n.apply(this,arguments)}}();(0,S.useEffect)((function(){w()}),[m]);var b=function(){s(void 0),w()},j=(0,S.useMemo)((function(){return Z>1010}),[Z]),y=function(n){s(n),d((function(e){return e.map((function(e){return e.id===n.id&&(e.unreadableMessages=0),(0,N.Z)({},e)}))}))};(0,B.ie)((function(e){var i=JSON.parse(e);if(i.event===pn.u.MESSAGE&&(l.find((function(n){return n.id===i.dialogId}))?d((function(e){return e.map((function(e){return e.id===i.dialogId&&(null===n||void 0===n?void 0:n.id)!==i.user.id&&((null===r||void 0===r?void 0:r.id)!==i.dialogId&&(e.unreadableMessages+=1),e.lastMessage=i),e.id===i.dialogId&&(null===n||void 0===n?void 0:n.id)===i.user.id&&(e.lastMessage=(0,N.Z)((0,N.Z)({},i),{},{read:!0})),(0,N.Z)({},e)})).sort((function(n,e){return Date.parse(e.lastMessage.updatedAt)-Date.parse(n.lastMessage.updatedAt)}))})):d((function(n){return[{id:i.dialogId,user:i.user,unreadableMessages:1,lastMessage:i}].concat((0,k.Z)(n))}))),i.event===pn.u.DELETE_MESSAGE){var t=JSON.parse(e);d((function(n){return n.map((function(n){return n.id===t.dialogId?(0,N.Z)((0,N.Z)({},n),{},{lastMessage:t.lastMessage}):n}))}))}}),[l,n]);var D=(0,S.useMemo)((function(){return f?(0,U.jsx)(H.QP,{}):l.length?r?(0,U.jsxs)(G,{children:[j&&(0,U.jsx)(L,{hasActive:!0,children:(0,U.jsx)(O,{hasActive:!0,children:l.map((function(n){return(0,U.jsx)(Y,{dialog:n,onClick:function(){return y(n)}},n.id)}))})}),(0,U.jsx)(gn,{dialogId:r.id,user:r.user,onBack:j?void 0:b})]}):(0,U.jsx)(G,{children:(0,U.jsx)(L,{children:(0,U.jsx)(O,{children:l.map((function(n){return(0,U.jsx)(Y,{dialog:n,onClick:function(){return y(n)}},n.id)}))})})}):(0,U.jsx)(X,{children:"\u0414\u0438\u0430\u043b\u043e\u0433\u043e\u0432 \u043d\u0435\u0442"})}),[l,f,r,j]);return(0,U.jsxs)(_,{children:[(0,U.jsx)(H.mr,{title:"\u0414\u0438\u0430\u043b\u043e\u0433\u0438",search:v,onChangeSearch:function(n){g(n.target.value)}}),D]})}}}]);
//# sourceMappingURL=847.f94dc0ea.chunk.js.map